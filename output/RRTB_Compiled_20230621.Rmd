---
title: "RR-TB Exploratory"
author: "Sarah Baum"
date: "2023-06-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

source(here::here("code/dependencies.R"))
```

### To do: 
- Diagnoses receiving Xpert relative to general population overtime
- Distributions in diagnoses by state
- Differences in specimen + smear/culture Xpert negative
- Clean implementation date (28 municipalities missing implementation date)

### Note: 
- Restricted to municipalities with at least one Xpert machine being implemented between Jan 2014 and Jan 2022. 
- Grouped by earliest date of Xpert implementation. 
- The bulk of municipalities began implementing in 2014 (60 municipalities), with 20, 10, and 17 municipalities starting to implement in the following years. This dropped off in 2019 to ~2 municipalities each year. 

# Xpert coverage
```{r, out.width='75%', echo = FALSE, fig.align = 'center'}
knitr::include_graphics(here::here("figures/fig_xpert_cov.png"))

knitr::include_graphics(here::here("figures/fig_TB_pos.png"))
knitr::include_graphics(here::here("figures/fig_RR_pos.png"))
```



# Patient characteristics
## Age category 
```{r, out.width='75%', echo = FALSE, fig.align = 'center'}
knitr::include_graphics(here::here("figures/fig_age_gen.png"))
knitr::include_graphics(here::here("figures/fig_age.png"))
knitr::include_graphics(here::here("figures/fig_age_month.png"))
```

## Sex
```{r, out.width='75%', echo = FALSE, fig.align = 'center'}
knitr::include_graphics(here::here("figures/fig_sex_gen.png"))
knitr::include_graphics(here::here("figures/fig_sex.png"))
knitr::include_graphics(here::here("figures/fig_sex_month.png"))
```

## HIV status
```{r, out.width='75%', echo = FALSE, fig.align = 'center'}
knitr::include_graphics(here::here("figures/fig_hiv_gen.png"))
knitr::include_graphics(here::here("figures/fig_hiv.png"))
knitr::include_graphics(here::here("figures/fig_hiv_month.png"))
```

## TB History
```{r, out.width='75%', echo = FALSE, fig.align = 'center'}
knitr::include_graphics(here::here("figures/fig_hist_gen.png"))
knitr::include_graphics(here::here("figures/fig_hist_year.png"))
knitr::include_graphics(here::here("figures/fig_hist_month.png"))
```

### Questions: 
- Sample:
  - Restrict to diagnoses in municipalities with at least one Xpert machine? 
  - How to treat municipalities that do not have machine, but are performing Xpert? - Hard to conceptualize impacts difference on selection and levels of "access" among municipalities without a machine?
  
- Geographic level of analysis: 
  - Municipality? Or state, facility? 
  
- Timeline: 
    - Start in 2014? Or after 2016 when there were stock outs? 
    - Level: Year? Month? 
    
- Steps for going from exploratory analysis to model. What to take away from what we know so far? What other questions should I be asking? 
